# 7-确保Web安全的HTTPS

## KeyPoint
* HTTPS并非应用层的一种新协议，只是HTTP通信接口部分用SSL(Secure Socket Layer) 和 TLS(TransportLayer Security)协议代替
* 公开密钥加密指的是发送密文的一方使用对方的公开密钥进行加密，接收方收到被加密的信息后通过私有密钥进行解密。
* HTTPS使用SSL(Secure Socket Layer)和TLS(Transport Layer Security)这两个协议

## Q&A
* HTTPS采用共享密钥加密和公开密钥加密有什么区别？
  * 公开密钥加密处理速度要慢，所以HTTPS采用混合加密机制。在交换密钥环节使用公开密钥加密防水，之后的建立通信交换报文阶段则使用共享密钥加密方式。
* 如何证明公开密钥是正确的？
  * 使用由数字证书认证机构(CA,Certificate Authority)和其相关机关颁发的公开密钥证书。
* 数字证书认证机构是如何工作的？
  * 1. 服务器运营人员向数字证书认证机构提出公开密钥的申请。
  * 2. 数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起。
  * 3. 服务器会将这份由数字证书认证机构颁发的公钥证书发给客户端，以进行公开密钥加密方式通信。
  * 4. 接到证书的客户端可使用数字证书认证机构的公开密钥，对证书的数字签名进行验证。
* 认证机关的公开密钥如何安全转交给客户端？
  * 多数浏览器开发商发布版本会事先在内部植入常用的认证机关的公开密钥。
* 自签名证书有什么优势？
  * 免费、随时签发、加密、方便（没有时间限制）。
* 自签名证书有什么应用场景？
  * 用于内部测试环境或限制外部人员访问的Web服务器。
* 中级认证机构有什么不同？
  * 证书由证书链的形式组织，在颁发证书时要有根CA认证机构颁发的根证书，再由根CA机构颁发一个中级CA机构的证书，最后由中级CA机构颁发具体的SSL证书。
* HTTPS是如何通信的？
  1. 客户端发送Client Hello报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件列表
  2. 服务器可进行SSL通信时，会以Server Hello报文作为应答。报文中包含SSL版本以及加密组件。是从客户端的加密组件中筛选出来的。


## A
1. HTTPS是如何通信的？
   1. 客户端发送Client Hello报文开始SSL通信。报文中包含客户端支持的SSL的指定版本、加密组件列表
   2. 服务器可进行SSL通信时，会以Server Hello报文作为应答。报文中包含SSL版本以及加密组件。是从客户端的加密组件中筛选出来的。
   3. 之后服务器发送Certificate报文。报文中包含公开密钥证书。
   4. 最后服务器发送Server Hello Done报文通知客户端，最初阶段的SSL握手协商部分结束
   5. SSL第一次握手结束后，客户端以Client Key Exchange报文作为回应。报文包含通信加密中使用的Pre-master-secret随机密码串。该报文已用步骤3的公开密钥进行加密。
   6. 接着客户端继续发送Change Cipher Spec报文。提示服务器之后的通信会采用Pre-master-secret密钥加密。
   7. 客户端发送Finished报文。报文包含连接至今全部报文的整体验证值。这次握手协商是否成功，要以服务器是否能够正确解密该报文作为判定标准。
   8. 服务器同样发送Change Cipher Spec报文。
   9. 服务器同样发送Finished 报文。
   10. 服务器和客户端的Finished报文交换完毕之后，SSL连接就算建立完成。通信会受到SSL的保护。从此处开始进行应用层协议的通信，即发送HTTP请求（客户端）。
   11. 应用层协议通信，发送HTTP响应。
   12. 最后由客户端断开连接。断开连接时，发送close_notify报文。在这步之后还会发送TCP FIN报文来关闭与TCP的通信。